# 06_文件加载和错误处理

## 1.文件加载的含义

概念：将一个文件包含到当前文件中，成为当前文件运行过程中的一部分

通常，一些公共代码，在多个页面都需要用到的时候，会做成一个独立的文件，然后在不同的页面需要用到的时候，直接加载进来就可以了



语法：

```php
include "要加在的文件的路径";//可以是相对路径或者是本地物理路径
```

说明：

可以载入php文件，也可以载入html文件

原理：

载入一个文件的本质是：将被载入文件插入到当前载入代码所在的位置

## 2.文件加载的四种方式

1. include  “要加载的文件”；
2. include_once "要加载的文件";
3. require "要加载的文件";
4. require_once "要加载的文件"；

其中，“要加载的文件”，是一个文件路径，可以是相对路劲，也可以是物理路径，或直接文件名



获取物理路径（绝对路径）的方式:

- `__DIR__`:表示当前文件所在路径，由它可以构建出绝对路径

- `getcwd();`:表示当前正访问的网页路径，由它可以构建出绝对路径

  `cwd();`：其实是current working directory的简写

非相对，非绝对路径方式不推荐使用

形式为：   include  ‘文件名’；

此时，会按如下顺序去寻找该文件：

1。先在php.ini中include_path项设定的目录中寻找该文件；

2。如果上一步没有找到，就在当前工作目录（由getcwd()获取）下寻找该文件；

3。如果上一步没有找到，就在当前载入语句的文件所在目录（由__DIR__获取）下寻找；

4。如果上一步还是没有找到，就报错了。



四种文件加载方式的区别：

- include：每次都载入文件（可能会重复载入），如果载入失败，在报错后继续执行后续语句；
- include_once：只载入一次（不会重复载入），如果载入失败，在报错后继续执行后续语句；
- require：每次都载入文件（可能会重复载入），如果载入失败，在报错后终止程序；
- require_once：只载入一次（不会重复载入），如果载入失败，在报错后终止程序；

一般来说，如果被载入的文件内容，是后续代码运行的必备前提，则应该使用require载入

如果被载入的文件内容，只需要出现一次则应该使用xxxx_once的载入方式



## 3.错误处理的分类

1. 语法错误

   程序不能运行，是在运行之前，检查语法的时候，就发现语法错误，结果是提示错误，不运行程序

2. 运行时错误

   语法检查没错，然后开始运行，在运行中出现了错误，然后报错

3. 逻辑错误

   程序可以运行，且一直到结束都没有报错，但执行得到的结果却是错误的

## 4. 常见错误代号

概念：是指在程序运行的时候，发生的错误，系统会针对每种错误给出响应的错误代号，并提示

另外，程序如果字运行之前检查语法的时候就发现语法错误，也会报错，同样有一个错误代号



1. E_NOTICE：

   提示性错误，轻微；

   错误发生后，后面的程序继续执行。

2. E_WARNING：

   警告性错误，稍微严重；

   错误发生后，后面的程序继续执行。

3. E_ERROR：

   严重错误/致命错误；

   错误发生后，后面的程序不再执行！

4. E_PARSE：

   语法错误（语法解析错误）；

   语法解释错误，是直接就不运行程序。

5. E_USER_NOTICE：

   用户自定义的提示错误

6. E_USER_WARNING：

   用户自定义的警告错误

7. E_USER_ERROR：

   用户自定义的严重错误

8. E_ALL：

   它是一个代表“所有”错误的代号。

说明：

- 这些错误代号，其实只是系统预先设定的一些常量，他们的值大约是：1， 2， 4， 8， 16.....

- 这些错误代号，通常只是 用于对错误控制时进行”设置“使用

- 他们是一系列整数，并具有一定的规律：1， 2， 4， 8， 16.....

- 可以在php.ini中使用（设置）他们，如下

  ![](C:\Users\宋天\Desktop\php\img\常见错误处理.png)

## 5. 错误触发

错误触发的两种情形：

1. 程序本身有错，则 运行时就会触发错误并提示

2. 程序本身无措，但出现不符合预计的情形

   此时，我们可以主动触发一个错误（主动创建一个错误），这就是用户错误，包括：

   - E_USER_NOTICE：
   - E_USER_WARNING：
   - E_USER_ERROR：

自定义错误触发语法：

```php
trigger_error("自定义错误提示内容"，自定义错误代号)
```

## 6. 错误显示设置

如果有错误发生，默认情况下会被显示在页面

我们可以对此进行设置，以决定下面两点：

1. 设置`display_errors`以决定是否显示错误：

   - 在php.ini中设置：	display_errors = On或Off

     这里设置，影响所有使用该php语言引擎的代码（网站页面）；

   - 在php文件中设置：	ini_set(‘display_errors’, 1或0);	//1表示显示，0不显示

     在这里设置，只影响当前网页代码本身。

2. 设置`error_reporting`以决定显示那些错误

   - 在php.ini中设置：	error_reporting = 错误代号1  | 错误代号2  |  ..... 

     //(要显示的就写出来，或者可以写E_ALL, 表示显示所有）

   - 在代php文件中，道理类似：ini_set(‘error_reporting’, 错误代号1  | 错误代号2  |  .....）

   ![](C:\Users\宋天\Desktop\php\img\错误代号.png)

## 7.错误日志设置

如果有错误发生，默认情况下不会讲错误信息记录下来

我们可以对此进行设置，以决定以下两点：

1. 设置log_errors以决定是否记录错误：

   - php.ini中设置：	 log_errors = On 或 Off

   - 代码文件中设置： ini_set (‘log_errors’, 1或0)

2. 设置error_log以决定记录到哪里：

   通常，就设置为一个文件名，php系统会在网站的每个文件夹下都建立该文件，并记录错误。

   - php.ini中： error_log = error.txt;		//它是纯文本的

   - 代码中： ini_set(“error_log”,  ‘error.txt’);

## 8.自定义错误处理

具体做法，分2步：

- 第1步：

  声明错误发生时，由我们自己来处理——设定一个错误处理的函数名。

  //set_error_handler("处理错误的自己的函数名");

  `set_error_handler("my_error_handler");`

- 第2步：

  定义该函数，在函数中详细设定错误的处理情况：怎么显示，显示什么，怎么记录，记录什么。

  `function my_error_handler($errCode, $errMsg, $errFile, $errLine)`

  //参数解释：errCode错误代号，errMsg错误信息，errfile错误文件，errline行号

  //此形参顺序固定，而且是由系统会调用该函数并传入实参数据！

  {

  ....处理错误的代码....

  }

注意：自定义错误只能处理“非致命错误”(就是不是E_ERROR错误）

案例：

![](C:\Users\宋天\Desktop\php\img\自定义错误.png)

